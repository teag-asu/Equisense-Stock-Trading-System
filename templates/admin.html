<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EquiSense - Admin Panel</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header>
    <h1>EquiSense</h1>
    <nav>
      <ul>
        {# <li><a href="{{ url_for('dashboard', user_id=user_id if 'user_id' in globals() else 1) }}">Trading Dashboard</a></li> #}
        <li><a href="{{ url_for('dashboard', user_id=session['user_id']) }}">Trading Dashboard</a></li>
        <li><a href="{{ url_for('admin') }}">Admin Panel</a></li>
      </ul>
    </nav>
	
  </header>

  <main>
    {# Optional flash area #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <section class="panel">
      <h2>Administrator Panel</h2>
      <ul class="admin-grid">
        <li><a href="{{ url_for('admin_stock_create') }}" class="admin-link" data-modal-title="Create New Stock">Create New Stock</a></li>
        <li><a href="{{ url_for('admin_market_hours') }}" class="admin-link" data-modal-title="Change Market Hours">Change Market Hours</a></li>
        <li><a href="{{ url_for('admin_market_schedule') }}" class="admin-link" data-modal-title="Set Market Schedule">Set Market Schedule</a></li>
        <li><a href="{{ url_for('admin_logs') }}" class="admin-link" data-modal-title="System Logs & Notifications">View System Logs</a></li>
        <li><a href="{{ url_for('admin_users') }}" class="admin-link" data-modal-title="Manage Users">Manage Users</a></li>
        <li><a href="{{ url_for('admin_stocks') }}" class="admin-link" data-modal-title="All Stocks">View All Stocks</a></li>
        <li><a href="{{ url_for('admin_stock_update') }}" class="admin-link" data-modal-title="Update Stock Prices">Update Stock Prices</a></li>
        <li><a href="{{ url_for('admin_settings') }}" class="admin-link" data-modal-title="System Settings">System Settings</a></li>
      </ul>
    </section>

    <!-- Modal -->
    <dialog id="adminModal" class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">Loadingâ€¦</h3>
        <button class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <iframe id="modalFrame" title="Admin Tool" loading="lazy"></iframe>
      </div>
    </dialog>
  </main>

  <footer>
    <p>&copy; 2025 EquiSense</p>
  </footer>

  <!-- Minimal JS to load admin routes inside modal -->
  <script>
    (function () {
      const modal = document.getElementById('adminModal');
      const frame = document.getElementById('modalFrame');
      const titleEl = document.getElementById('modalTitle');
      const closeBtn = modal.querySelector('.modal-close');

      function openModal(href, titleText) {
        titleEl.textContent = titleText || 'Admin Tool';
        frame.src = href;
        if (typeof modal.showModal === 'function') {
          modal.showModal();
        } else {
          modal.setAttribute('open', 'open'); // fallback
        }
      }

      function closeModal() {
        frame.src = 'about:blank';
        if (typeof modal.close === 'function') {
          modal.close();
        } else {
          modal.removeAttribute('open');
        }
      }

      // Intercept clicks on admin links
      document.addEventListener('click', function (e) {
        const link = e.target.closest('a.admin-link');
        if (!link) return;

        // allow new tab / modifiers
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.button === 1) return;

        e.preventDefault();
        openModal(link.getAttribute('href'), link.getAttribute('data-modal-title'));
      });

      // Close handlers
      closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('cancel', (e) => { e.preventDefault(); closeModal(); }); // ESC
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); }); // backdrop
    })();
  </script>
</body>
</html>

